---
phase: 02-shell-environment-and-config-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dotfiles/.zshrc
  - dotfiles/.zsh_aliases
  - dotfiles/.tmux.conf
  - dotfiles/starship.toml
autonomous: true
requirements: [CONF-01, CONF-02, CONF-03, CONF-04, CONF-05]

must_haves:
  truths:
    - "dotfiles/.zshrc enables oh-my-zsh with autosuggestions + syntax-highlighting plugins, sources .zsh_aliases, and initializes starship as the last line"
    - "dotfiles/.zsh_aliases provides server-side aliases that mirror the macOS feel (ls -> eza, cat -> bat, grep -> rg equivalents, git shortcuts)"
    - "dotfiles/.tmux.conf provides a usable tmux config (sensible prefix, mouse support, sane copy-mode)"
    - "dotfiles/starship.toml is a valid TOML config that works on headless servers without Nerd Fonts, showing hostname and user always"
    - "All four files are self-contained and deployable as symlinks into $HOME (starship.toml targets $HOME/.config/)"
  artifacts:
    - path: "dotfiles/.zshrc"
      provides: "zsh config — loads oh-my-zsh, two plugins, sources .zsh_aliases, initializes starship last"
      contains: "eval \"$(starship init zsh)\""
    - path: "dotfiles/.zsh_aliases"
      provides: "shell aliases shared across server sessions — macOS-like feel without cross-platform conditionals"
      min_lines: 20
    - path: "dotfiles/.tmux.conf"
      provides: "tmux config with prefix, mouse, copy-mode"
      min_lines: 10
    - path: "dotfiles/starship.toml"
      provides: "starship prompt config — no Nerd Fonts, shows user@hostname, server-appropriate"
      contains: "ssh_only = false"
  key_links:
    - from: "dotfiles/.zshrc"
      to: "oh-my-zsh"
      via: "source $ZSH/oh-my-zsh.sh with plugins=(git zsh-autosuggestions zsh-syntax-highlighting)"
      pattern: "source.*oh-my-zsh\\.sh"
    - from: "dotfiles/.zshrc"
      to: "dotfiles/.zsh_aliases"
      via: "[[ -f ${HOME}/.zsh_aliases ]] && source ${HOME}/.zsh_aliases"
      pattern: "source.*zsh_aliases"
    - from: "dotfiles/.zshrc"
      to: "starship"
      via: "eval \"$(starship init zsh)\" as last line"
      pattern: "eval.*starship init zsh"
    - from: "dotfiles/starship.toml"
      to: "$HOME/.config/starship.toml"
      via: "symlink created by deploy_dotfiles in install-shell.sh (Plan 02)"
      pattern: "starship\\.toml"
---

<objective>
Create the four dotfiles that define the server shell environment: .zshrc, .zsh_aliases, .tmux.conf, and starship.toml. These live in the dotfiles/ directory at the repo root and are deployed as symlinks by the Phase 2 installer script (Plan 02).

Purpose: Provide the actual content of the shell environment — the configs that make the server feel familiar (same aliases, same starship prompt, same tmux). These files are the payload that scripts/install-shell.sh deploys.

Output: dotfiles/ directory with four files ready for symlink deployment.
</objective>

<execution_context>
@/Users/elmartinez85/.claude/get-shit-done/workflows/execute-plan.md
@/Users/elmartinez85/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-shell-environment-and-config-deployment/02-CONTEXT.md
@.planning/phases/02-shell-environment-and-config-deployment/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dotfiles/ directory and .zshrc</name>
  <files>dotfiles/.zshrc</files>
  <action>
Create the `dotfiles/` directory at the repo root (it does not exist yet — distinct from the existing `config/` dir which holds a .gitkeep). Then create `dotfiles/.zshrc`.

The .zshrc must follow the exact structure from the research (Pattern 7). Critical ordering constraints:
1. Set `export ZSH="${HOME}/.oh-my-zsh"` — oh-my-zsh home
2. Set `ZSH_THEME=""` — MUST be empty string, NOT a named theme; starship replaces oh-my-zsh's theme system entirely. A named theme causes two prompts fighting.
3. Set `plugins=(git zsh-autosuggestions zsh-syntax-highlighting)` — all three listed
4. `source "$ZSH/oh-my-zsh.sh"` — loads oh-my-zsh and plugins
5. `[[ -f "${HOME}/.zsh_aliases" ]] && source "${HOME}/.zsh_aliases"` — conditional source of aliases
6. `eval "$(starship init zsh)"` — MUST BE LAST LINE. Using double quotes is required since starship v1.17.0 (unquoted breaks). Placing this before oh-my-zsh source would cause oh-my-zsh to reset $PROMPT and starship's prompt would disappear.

No macOS conditionals or cross-platform code — this is Linux-only per phase boundary.

Also include a header comment identifying the file's purpose and that it is managed by server-dotfiles.
  </action>
  <verify>
bash -n dotfiles/.zshrc
grep -q 'ZSH_THEME=""' dotfiles/.zshrc
grep -q 'zsh-autosuggestions' dotfiles/.zshrc
grep -q 'zsh-syntax-highlighting' dotfiles/.zshrc
grep -q 'source.*oh-my-zsh.sh' dotfiles/.zshrc
grep -q 'zsh_aliases' dotfiles/.zshrc
grep -q 'eval "$(starship init zsh)"' dotfiles/.zshrc
# Confirm starship init is the last non-empty, non-comment line
tail -5 dotfiles/.zshrc
  </verify>
  <done>dotfiles/.zshrc passes bash -n, contains ZSH_THEME="", all three plugins listed, sources oh-my-zsh, conditionally sources .zsh_aliases, and ends with eval "$(starship init zsh)" as the last executable line.</done>
</task>

<task type="auto">
  <name>Task 2: Create .zsh_aliases, .tmux.conf, and starship.toml</name>
  <files>dotfiles/.zsh_aliases, dotfiles/.tmux.conf, dotfiles/starship.toml</files>
  <action>
Create the remaining three dotfiles.

**dotfiles/.zsh_aliases**

Linux-only aliases that provide a macOS-like feel. Include:
- Navigation shortcuts: `alias ..='cd ..'`, `alias ...='cd ../..'`, `alias -- -='cd -'`
- Directory listing using eza (Phase 3 installs it; guard with command -v check or just define — these aliases are sourced only when zsh starts, not at deploy time): `alias ls='eza'`, `alias ll='eza -lh'`, `alias la='eza -lah'`, `alias lt='eza --tree'`
- File viewing with bat: `alias cat='bat --pager=never'`
- grep aliases pointing to ripgrep: `alias grep='rg'`
- git shortcuts: `alias gs='git status'`, `alias ga='git add'`, `alias gc='git commit'`, `alias gp='git push'`, `alias gl='git log --oneline --graph --decorate'`, `alias gd='git diff'`
- General: `alias c='clear'`, `alias h='history'`, `alias reload='exec zsh'`
- Docker shortcuts (for Phase 3 readiness): `alias d='docker'`, `alias dc='docker compose'`

Include a header comment that this file is sourced by .zshrc and managed by server-dotfiles.

Note: These aliases reference eza, bat, rg — those binaries are installed in Phase 3. The aliases file is sourced at shell startup, not at deploy time, so referencing future binaries is fine; zsh will resolve them at invocation time.

**dotfiles/.tmux.conf**

A sensible tmux config for server use:
- Change prefix from C-b to C-a (screen-style, easier to reach): `set -g prefix C-a` + `unbind C-b` + `bind C-a send-prefix`
- Enable mouse support: `set -g mouse on`
- Use vim keys in copy mode: `setw -g mode-keys vi`
- Start window and pane indices at 1 (easier to reach on keyboard): `set -g base-index 1` + `setw -g pane-base-index 1`
- Renumber windows on close: `set -g renumber-windows on`
- Increase history limit: `set -g history-limit 10000`
- Split panes with | and - (intuitive): `bind | split-window -h` + `bind - split-window -v`
- Enable true color if terminal supports it: `set -g default-terminal "screen-256color"`
- Reduce escape-time for vim users: `set -sg escape-time 10`

Include a header comment managed by server-dotfiles.

**dotfiles/starship.toml**

A minimal starship config that works on headless servers without Nerd Fonts. Key requirements per RESEARCH.md Pattern 8:
- Include `"$schema" = 'https://starship.rs/config-schema.json'`
- `[hostname]` section: `ssh_only = false` (show hostname always, not just over SSH — critical for server awareness), `style = "bold green"`, `format = "[$hostname]($style) "`
- `[username]` section: `show_always = true`, `style_user = "bold blue"`, `format = "[$user]($style)@"`
- `[directory]` section: `truncation_length = 3`, `truncate_to_repo = false`
- `[git_branch]` section: `symbol = "git:"` (no Nerd Font symbol — use plain text)
- `[git_status]` section: keep defaults but ensure no Nerd Font-only symbols
- Do NOT use any Nerd Font symbols (no  ,  , etc.) — servers won't have Nerd Fonts installed; use plain ASCII/text alternatives

Include a comment at the top explaining this is the server-dotfiles managed starship config.
  </action>
  <verify>
# Aliases file has minimum content
wc -l dotfiles/.zsh_aliases
grep -q 'alias ls=' dotfiles/.zsh_aliases
grep -q 'alias gs=' dotfiles/.zsh_aliases
grep -q 'alias reload=' dotfiles/.zsh_aliases

# tmux config has key settings
grep -q 'prefix C-a' dotfiles/.tmux.conf
grep -q 'mouse on' dotfiles/.tmux.conf
grep -q 'mode-keys vi' dotfiles/.tmux.conf

# starship.toml has required server settings
grep -q 'ssh_only = false' dotfiles/starship.toml
grep -q 'show_always = true' dotfiles/starship.toml
grep -q 'schema' dotfiles/starship.toml

# All four dotfiles exist
ls -la dotfiles/
  </verify>
  <done>dotfiles/.zsh_aliases has navigation, listing, git, and reload aliases (20+ lines). dotfiles/.tmux.conf has C-a prefix, mouse on, vim copy-mode. dotfiles/starship.toml has ssh_only=false, show_always=true, no Nerd Font symbols. All four files in dotfiles/ directory.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `ls dotfiles/` shows .zshrc, .zsh_aliases, .tmux.conf, starship.toml — all four files present
2. `bash -n dotfiles/.zshrc` exits 0 (no syntax errors)
3. `grep -c 'starship init zsh' dotfiles/.zshrc` returns 1 (exactly once, at end)
4. `grep -q 'ZSH_THEME=""' dotfiles/.zshrc` exits 0
5. `grep -q 'ssh_only = false' dotfiles/starship.toml` exits 0 (server-always-show hostname)
6. `grep -q 'mouse on' dotfiles/.tmux.conf` exits 0
7. `wc -l dotfiles/.zsh_aliases` shows 20+ lines
</verification>

<success_criteria>
The dotfiles/ directory exists at the repo root with four complete, syntactically valid config files. .zshrc correctly sequences oh-my-zsh load → aliases → starship init (in that order). starship.toml works on headless servers without Nerd Fonts. .tmux.conf provides a comfortable server tmux experience. .zsh_aliases gives the server shell a macOS-like feel via aliases for modern CLI tools (installed in Phase 3).
</success_criteria>

<output>
After completion, create `.planning/phases/02-shell-environment-and-config-deployment/02-01-SUMMARY.md`
</output>
