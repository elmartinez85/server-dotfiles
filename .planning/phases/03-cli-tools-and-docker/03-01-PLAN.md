---
phase: 03-cli-tools-and-docker
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/versions.sh
  - scripts/install-gitleaks.sh
autonomous: true
requirements:
  - TOOL-01
  - TOOL-02
  - TOOL-03
  - TOOL-04
  - TOOL-05
  - TOOL-06
  - TOOL-07
  - DOCK-04

must_haves:
  truths:
    - "lib/versions.sh exists and exports all pinned version variables for all phases (gitleaks, all seven CLI tools, lazydocker)"
    - "install-gitleaks.sh sources lib/versions.sh and no longer has a hardcoded GITLEAKS_VERSION variable"
    - "Sourcing versions.sh twice is a no-op (idempotency guard present)"
  artifacts:
    - path: "lib/versions.sh"
      provides: "Canonical version store — all pinned tool versions across all phases"
      contains: "GITLEAKS_VERSION, RIPGREP_VERSION, FD_VERSION, FZF_VERSION, EZA_VERSION, BAT_VERSION, DELTA_VERSION, NVIM_VERSION, LAZYDOCKER_VERSION"
    - path: "scripts/install-gitleaks.sh"
      provides: "Updated gitleaks installer — sources versions.sh instead of hardcoded version"
      contains: "source.*lib/versions.sh"
  key_links:
    - from: "scripts/install-gitleaks.sh"
      to: "lib/versions.sh"
      via: "source ${DOTFILES_DIR}/lib/versions.sh"
      pattern: "source.*lib/versions\\.sh"
---

<objective>
Create lib/versions.sh as the canonical version store for all pinned tool versions across all phases, then update install-gitleaks.sh to source it instead of using the hardcoded GITLEAKS_VERSION variable.

Purpose: Phase 4 Renovate Bot setup needs a single file to target for automated version PRs. install-tools.sh and install-docker.sh (Plans 02 and 03) will source this file. Without this, versions are scattered across install scripts — defeating the purpose of centralization.

Output: lib/versions.sh with all nine version variables; install-gitleaks.sh with hardcoded version removed.
</objective>

<execution_context>
@/Users/elmartinez85/.claude/get-shit-done/workflows/execute-plan.md
@/Users/elmartinez85/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-cli-tools-and-docker/03-CONTEXT.md
@.planning/phases/03-cli-tools-and-docker/03-RESEARCH.md
@scripts/install-gitleaks.sh
@lib/log.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lib/versions.sh — canonical version store</name>
  <files>lib/versions.sh</files>
  <action>
Create lib/versions.sh following the established lib/ guard pattern (see lib/log.sh, lib/os.sh for reference). The file must:

1. Use the standard idempotency guard at the top:
   ```bash
   #!/usr/bin/env bash
   # lib/versions.sh
   # Canonical version store for all pinned tool versions across all phases.
   # Sourced by: install-gitleaks.sh, install-tools.sh, install-docker.sh
   # Do NOT execute directly.
   if [[ -n "${_LIB_VERSIONS_LOADED:-}" ]]; then return 0; fi
   _LIB_VERSIONS_LOADED=1
   ```

2. Define version variables in three labeled sections (Phase 1, Phase 3 CLI tools, Phase 3 Docker):
   - `GITLEAKS_VERSION="8.30.0"` (Phase 1 — matches current hardcoded value in install-gitleaks.sh)
   - `RIPGREP_VERSION="15.1.0"`
   - `FD_VERSION="10.3.0"`
   - `FZF_VERSION="0.68.0"`
   - `EZA_VERSION="0.23.4"`
   - `BAT_VERSION="0.26.1"`
   - `DELTA_VERSION="0.18.2"`
   - `NVIM_VERSION="0.11.6"`
   - `LAZYDOCKER_VERSION="0.24.4"`

3. Add a comment: `# Docker Engine version is managed by apt (always installs latest stable from pinned repo)`

Section comment format:
```bash
# ── Phase 1: Secret prevention ────────────────────────────────────────────────

# ── Phase 3: CLI tools ────────────────────────────────────────────────────────

# ── Phase 3: Docker tools ─────────────────────────────────────────────────────
```

Do NOT export the variables — sourcing scripts assign them as locals or globals as needed. The pattern in this codebase is to set variables without `export` in lib files (export happens in the caller where needed).
  </action>
  <verify>
bash -c 'source lib/versions.sh && echo "RIPGREP=${RIPGREP_VERSION} NVIM=${NVIM_VERSION} LAZYDOCKER=${LAZYDOCKER_VERSION}" && source lib/versions.sh && echo "Double-source idempotent OK"'
  </verify>
  <done>
lib/versions.sh exists with all nine version variables. Sourcing it twice produces no output or errors (idempotency guard works). All version values match the pinned versions from RESEARCH.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update install-gitleaks.sh to source versions.sh</name>
  <files>scripts/install-gitleaks.sh</files>
  <action>
Remove the hardcoded `GITLEAKS_VERSION="8.30.0"` and `GITLEAKS_INSTALL_PATH="/usr/local/bin/gitleaks"` variable declarations from install-gitleaks.sh (lines 8-9 per current file) and replace with a source call to lib/versions.sh.

The new source line must come AFTER the `_SCRIPT_INSTALL_GITLEAKS_LOADED` guard block and BEFORE `install_gitleaks()`. Reference `$DOTFILES_DIR` for the path (same as install-shell.sh uses for sourcing):

```bash
# Source canonical version store — provides GITLEAKS_VERSION
# shellcheck source=lib/versions.sh
source "${DOTFILES_DIR}/lib/versions.sh"

GITLEAKS_INSTALL_PATH="/usr/local/bin/gitleaks"
```

Keep `GITLEAKS_INSTALL_PATH` as a module-level variable (it was there before, keep it). Only remove the `GITLEAKS_VERSION` hardcoded assignment.

The rest of install-gitleaks.sh (install_gitleaks, install_pre_commit_hook, scan_git_history functions) remains exactly as-is. No functional changes — only the version variable source changes.

After editing, verify the file still passes bash syntax check: `bash -n scripts/install-gitleaks.sh`
  </action>
  <verify>
bash -n scripts/install-gitleaks.sh && grep -v 'GITLEAKS_VERSION="8.30.0"' scripts/install-gitleaks.sh | grep -q 'source.*lib/versions.sh' && echo "OK: no hardcoded version, source present"
  </verify>
  <done>
install-gitleaks.sh has no hardcoded GITLEAKS_VERSION="..." assignment. It sources lib/versions.sh. bash -n reports no syntax errors. The file still contains all three original functions unchanged.
  </done>
</task>

</tasks>

<verification>
1. `bash -n lib/versions.sh` — no syntax errors
2. `bash -n scripts/install-gitleaks.sh` — no syntax errors
3. `grep -c 'GITLEAKS_VERSION="8.30.0"' scripts/install-gitleaks.sh` returns 0 (hardcoded version gone)
4. `bash -c 'source lib/versions.sh && [[ "$GITLEAKS_VERSION" == "8.30.0" ]] && echo OK'` passes
5. `bash -c 'source lib/versions.sh && [[ "$LAZYDOCKER_VERSION" == "0.24.4" ]] && echo OK'` passes
</verification>

<success_criteria>
lib/versions.sh exists with all nine version variables. install-gitleaks.sh sources versions.sh and has no hardcoded version string. Both files pass bash -n syntax check. Double-sourcing versions.sh is a no-op.
</success_criteria>

<output>
After completion, create `.planning/phases/03-cli-tools-and-docker/03-01-SUMMARY.md`
</output>
