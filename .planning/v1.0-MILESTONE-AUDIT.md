---
milestone: v1.0
audited: 2026-02-22T00:00:00Z
status: tech_debt
scores:
  requirements: 26/26
  phases: 3/3
  integration: 18/18
  flows: 6/6
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 02-shell-environment-and-config-deployment
    items:
      - "install_starship() has no idempotency pre-check — always re-downloads and re-installs starship on every bootstrap re-run; all other binary installers check version before downloading. Accumulates duplicate manifest entries. Affects BOOT-02, SHELL-03."
      - "install_tmux() unconditionally appends to _SUMMARY_INSTALLED — pkg_install handles actual idempotency correctly but install_tmux wraps it in a post-check that always fires true, so tmux always appears under 'Installed' in bootstrap summary even on re-runs. Affects SHELL-04 summary output only."
  - phase: cross-phase
    items:
      - "MAINT-01 traceability inconsistency — REQUIREMENTS.md traceability table maps MAINT-01 to 'Phase 4' but it was delivered in Phase 3 (Plan 03-01, lib/versions.sh). The checkbox [x] and 'Complete' status are correct. Only the phase column is wrong. No functional impact."
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 — server-dotfiles bootstrap system
**Audited:** 2026-02-22
**Status:** TECH DEBT (no blockers, 2 idempotency robustness items + 1 documentation inconsistency)
**Phases in scope:** 3/3 completed (Phase 4: Security and Maintenance not yet planned — out of scope)

---

## Scores

| Category | Score | Detail |
|----------|-------|--------|
| Requirements | 26/26 | All requirements for executed phases satisfied |
| Phases | 3/3 | All 3 phase verifications passed |
| Integration wiring | 18/18 | All cross-phase connections verified |
| E2E flows | 6/6 | Complete; 1 partial robustness concern |

---

## Phase Verification Summary

| Phase | Status | Score | Human Verification Items |
|-------|--------|-------|--------------------------|
| 01: Foundation | passed | 4/4 | 5 (live server required) |
| 02: Shell Environment | human_needed | 9/9 automated | 5 (interactive terminal required) |
| 03: CLI Tools and Docker | passed | 16/16 | 4 (live hardware required) |

**Note on Phase 02 `human_needed` status:** All 9 automated truths verified. All 11 requirements satisfied at code level. Status reflects that prompt rendering, plugin activation, and tmux key bindings require a live interactive terminal session to confirm — static analysis cannot verify these behaviors. This is not a gap; it is a verification constraint.

---

## Requirements Coverage (3-Source Cross-Reference)

Sources checked per requirement:
1. **VERIFICATION.md** — phase verifier status (passed/human_needed/gaps_found)
2. **SUMMARY.md `provides`** — what each plan declares it delivers
3. **REQUIREMENTS.md traceability** — checkbox + status field

### Phase 1: Foundation

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-------------|-------------|---------|-----------------|--------------|
| BOOT-01 | curl\|bash bootstrap | passed | 01-02 provides bootstrap.sh entrypoint | `[x]` Complete | **satisfied** |
| BOOT-02 | Idempotent bootstrap | passed | 01-01/02 provides idempotency guards | `[x]` Complete | **satisfied** |
| BOOT-03 | Arch detection | passed | 01-01 provides os_detect_arch (x86_64/arm64) | `[x]` Complete | **satisfied** |
| BOOT-04 | Pre-commit secret prevention | passed | 01-03 provides hooks/pre-commit + install-gitleaks.sh | `[x]` Complete | **satisfied** |

### Phase 2: Shell Environment

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-------------|-------------|---------|-----------------|--------------|
| SHELL-01 | zsh as default shell | human_needed (code verified) | 02-02 provides install_zsh() | `[x]` Complete | **satisfied** |
| SHELL-02 | oh-my-zsh unattended | human_needed (code verified) | 02-02 provides install_ohmyzsh() | `[x]` Complete | **satisfied** |
| SHELL-03 | starship active in zsh | human_needed (code verified) | 02-02 provides install_starship(); 02-01 provides .zshrc with starship init last line | `[x]` Complete | **satisfied** |
| SHELL-04 | tmux installed | human_needed (code verified) | 02-02 provides install_tmux() | `[x]` Complete | **satisfied** |
| SHELL-05 | zsh-autosuggestions active | human_needed (code verified) | 02-02 provides install_zsh_plugins() + zsh-autosuggestions clone | `[x]` Complete | **satisfied** |
| SHELL-06 | zsh-syntax-highlighting active | human_needed (code verified) | 02-02 provides install_zsh_plugins() + zsh-syntax-highlighting clone | `[x]` Complete | **satisfied** |
| CONF-01 | .zshrc + aliases symlinked | human_needed (code verified) | 02-02 provides deploy_dotfiles(); 02-01 provides .zshrc + .zsh_aliases | `[x]` Complete | **satisfied** |
| CONF-02 | .tmux.conf symlinked | human_needed (code verified) | 02-02 provides deploy_dotfiles(); 02-01 provides .tmux.conf | `[x]` Complete | **satisfied** |
| CONF-03 | starship.toml to $HOME/.config | human_needed (code verified) | 02-02 provides deploy_dotfiles() with mkdir -p .config; 02-01 provides starship.toml | `[x]` Complete | **satisfied** |
| CONF-04 | Pre-existing configs backed up | human_needed (code verified) | 02-02 provides _deploy_symlink() backup logic | `[x]` Complete | **satisfied** |
| CONF-05 | macOS-like shell experience | human_needed (code verified) | 02-01 provides .zsh_aliases with eza/bat/rg/git/docker shortcuts | `[x]` Complete | **satisfied** |

### Phase 3: CLI Tools and Docker

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-------------|-------------|---------|-----------------|--------------|
| TOOL-01 | ripgrep as `rg` | passed | 03-02 provides install_ripgrep() → /usr/local/bin/rg | `[x]` Complete | **satisfied** |
| TOOL-02 | fd as `fd` | passed | 03-02 provides install_fd() → /usr/local/bin/fd | `[x]` Complete | **satisfied** |
| TOOL-03 | fzf as `fzf` | passed | 03-02 provides install_fzf() → /usr/local/bin/fzf | `[x]` Complete | **satisfied** |
| TOOL-04 | eza as `eza` | passed | 03-02 provides install_eza() → /usr/local/bin/eza | `[x]` Complete | **satisfied** |
| TOOL-05 | bat as `bat` | passed | 03-02 provides install_bat() → /usr/local/bin/bat | `[x]` Complete | **satisfied** |
| TOOL-06 | delta as `delta` | passed | 03-02 provides install_delta() → /usr/local/bin/delta | `[x]` Complete | **satisfied** |
| TOOL-07 | neovim as `nvim` | passed | 03-02 provides install_nvim() → /usr/local/bin/nvim | `[x]` Complete | **satisfied** |
| DOCK-01 | Docker Engine (x86_64 + ARM64) | passed | 03-03 provides install_docker_engine() via official apt repo | `[x]` Complete | **satisfied** |
| DOCK-02 | docker compose plugin | passed | 03-03 provides docker-compose-plugin in apt block | `[x]` Complete | **satisfied** |
| DOCK-03 | docker group (no sudo) | passed | 03-03 provides add_user_to_docker_group() | `[x]` Complete | **satisfied** |
| DOCK-04 | lazydocker installed | passed | 03-03 provides install_lazydocker() flat archive | `[x]` Complete | **satisfied** |
| MAINT-01 | Versions centralized in versions.sh | passed | 03-01 provides lib/versions.sh (9 pinned versions) | `[x]` Complete *(traceability says Phase 4 — doc error)* | **satisfied** |

**Orphan detection:** Zero orphaned requirements. All 26 REQ-IDs in scope appear in at least one phase VERIFICATION.md and are `[x]` checked in REQUIREMENTS.md.

---

## Cross-Phase Integration

**18 wiring points verified. 0 broken. 2 tech debt items.**

| Wiring | Status | Notes |
|--------|--------|-------|
| curl\|bash → bootstrap.sh → P1 → P2 → P3 | CONNECTED | Correct execution order; dependency ordering rationale documented inline |
| ARCH: lib/os.sh → bootstrap.sh → all phase scripts | CONNECTED | `export ARCH` at bootstrap.sh:129; consumed by all arch-aware installers |
| DRY_RUN: bootstrap.sh → all phase scripts | CONNECTED | All install functions guard behind `${DRY_RUN:-false}`; safe default |
| MANIFEST_FILE + _SUMMARY arrays | CONNECTED | Defined in bootstrap.sh before sourcing; all phases append correctly |
| lib/versions.sh → all 4 consumers | CONNECTED | install-gitleaks.sh:10, install-tools.sh:13, install-docker.sh:13, verify.sh:11 |
| .zsh_aliases → eza/bat/rg/docker binaries (Phase 3) | CONNECTED | Aliases resolve at invocation time; ordering safe — Phase 2 symlinks, Phase 3 installs |
| bootstrap.sh phase ordering | CONNECTED | P1 → P2 (zsh → ohmyzsh → plugins → starship → tmux → deploy) → P3 (7 CLI tools → docker engine → group → lazydocker) |
| verify.sh BASH_SOURCE[0] path resolution | CONNECTED | cwd-independent; resolves dotfiles root via dirname(dirname(BASH_SOURCE[0])) |

### Tech Debt Issues Found

**TD-1: `install_starship` missing idempotency pre-check**
- File: `scripts/install-shell.sh:92-105`
- Impact: BOOT-02, SHELL-03
- Description: All other binary installers (gitleaks, ripgrep, fd, fzf, eza, bat, delta, nvim, lazydocker) check version before downloading. `install_starship` unconditionally re-downloads and re-runs the official installer on every bootstrap run. Also writes a duplicate `file:/usr/local/bin/starship` manifest entry on each re-run.
- Severity: Low — no functional break; official installer is idempotent; bootstrap summary shows misleading repeated "installed" for starship
- Fix: Add `if [[ -x /usr/local/bin/starship ]] && /usr/local/bin/starship --version | grep -qF "$STARSHIP_VERSION"; then skip; fi` guard (requires adding STARSHIP_VERSION to lib/versions.sh)

**TD-2: `install_tmux` summary tracking always reports "Installed"**
- File: `scripts/install-shell.sh:109-119`
- Impact: SHELL-04 summary output
- Description: `pkg_install` handles real idempotency (skips if tmux already installed), but `install_tmux` wraps it with a post-check `if pkg_installed tmux` that always returns true after `pkg_install` succeeds, unconditionally appending to `_SUMMARY_INSTALLED`. On re-runs, tmux always appears under "Installed" instead of "Skipped (already present)".
- Severity: Low — no functional break; misleading bootstrap summary only
- Fix: Track whether `pkg_install` actually installed (vs skipped) or move to a pattern like other pkg-based installers

**Documentation Inconsistency (not tech debt):**
- REQUIREMENTS.md traceability table: `MAINT-01 | Phase 4 | Complete` — the phase column should say "Phase 3"
- The `[x]` Complete status is correct; only the phase column is wrong
- Fix: Update traceability table row from "Phase 4" to "Phase 3"

---

## E2E Flow Verification

| Flow | Status | Notes |
|------|--------|-------|
| Fresh server bootstrap: `curl <url> \| bash` → all tools installed | COMPLETE | Full chain wired; requires live network for actual download/install |
| Idempotent re-run: second bootstrap on same server | COMPLETE (with TD-1/TD-2) | Core idempotency sound; starship and tmux summary have cosmetic issues |
| Arch detection: x86_64 and arm64 | COMPLETE | os_detect_arch() covers both; _arch_for_tool() maps all 7 tool URL naming conventions |
| Secret prevention: pre-commit blocks staged secrets | COMPLETE | hooks/pre-commit wired; gitleaks binary installed by bootstrap |
| Shell environment: zsh + ohmyzsh + starship + tmux on fresh login | COMPLETE (human verification required) | All config files deployed; live session behavior requires human testing |
| No-sudo Docker: docker group membership after re-login | COMPLETE (human verification required) | usermod call correct; only verifiable after actual re-login on target server |

---

## Human Verification Items (aggregated across phases)

These items cannot be verified by static analysis. All require a live server or interactive session:

**Phase 1 (5 items):**
1. End-to-end bootstrap smoke test on fresh Ubuntu/RPi server
2. `--dry-run` flag behavior via curl-pipe
3. Pre-commit hook blocks a real staged secret
4. Idempotent re-run (second bootstrap)
5. Architecture detection on x86_64 hardware

**Phase 2 (5 items):**
6. Starship prompt renders in live zsh session (user@hostname, no artifacts)
7. zsh-autosuggestions ghost text visible when typing
8. zsh-syntax-highlighting colors valid/invalid commands
9. tmux C-a prefix works (C-b disabled as prefix)
10. Full idempotency on second bootstrap run (all 6 Phase 2 functions skip correctly)

**Phase 3 (4 items):**
11. All 7 CLI tools install and pass `verify.sh` on x86_64 server
12. Docker Engine installs from correct repo on RPi OS arm64 (raspbian→debian detection)
13. No-sudo docker run after re-login confirms group membership
14. lazydocker TUI launches and shows container UI

---

## Unsatisfied Requirements

None. All 26 requirements in scope are satisfied.

**Out-of-scope requirements (Phase 4 — not yet planned):**
SEC-01, SEC-02, SEC-03, SEC-04, SEC-05, SEC-06, MAINT-02 — these are pending and will be addressed when Phase 4 (Security and Maintenance) is planned and executed.

---

_Audited: 2026-02-22_
_Auditor: Claude (gsd-audit-milestone orchestrator + gsd-integration-checker subagent)_
